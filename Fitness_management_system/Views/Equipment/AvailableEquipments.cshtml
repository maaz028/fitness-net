@model IEnumerable<EquipmentModel>
@{
    ViewBag.Title = "Admin | Available Equipments";
    ViewBag.EquipmentDetailsActive = "active open";
    ViewBag.AvailableEquipmentsActive = "active";
}

<div class="container-xxl flex-grow-1 container-p-y">
    <div class="my-4">
        <a asp-controller="Equipment" asp-action="AddEquipment" type="button" class="btn btn-danger">Add Equipment </a>
    </div>
    <div class="card">
        <h5 class="card-header">Available Equipments</h5>
        <div class="">
            @if (Model.Any())
            { 
                <form id="submitEntries" asp-controller="Equipment" asp-action="AvailableEquipments" asp-route-pageNumber="1" method="get" class=" my-1 p-2" style="display: flex;flex-direction: row;">
        Show&emsp;
        <div>
            <select onchange="changeEntries()" type="text" id="entries"  name="entries" style="display: inline-block;width:100px">
            <option value="2">2</option>
            <option value="5">5</option>
            <option value="10">10</option>
            <option value="15">15</option>
            <option value="20">20</option>
            <option value="25">25</option>
            <option value="30">30</option>
            <option value="35">35</option>
        </select>&emsp; Entries</div>
          
    </form>
                <table class="table table-dark">
                    <thead>
                        <tr>
                            <th>S.No</th>
                            <th>Equipment</th>
                            <th>Name</th>
                            <th>Description</th>
                            <th>Created Date</th>
                            <th>Last Updated</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody class="table-border-bottom-0">
                        @{
                            int i = ViewBag.SerialNo;
                        }
                        @foreach (var eqp in Model.ToList())
                        {
                            <tr>
                                <td><i class="fab fa-angular fa-lg text-danger me-3"></i> <strong>@i</strong></td>
                                <td>
                                    <ul class="list-unstyled users-list m-0 avatar-group d-flex align-items-center">
                                        <li data-bs-toggle="tooltip" data-popup="tooltip-custom" data-bs-placement="top" class="avatar avatar-xs pull-up" title="" data-bs-original-title="@eqp.Name">
                                            @if (!string.IsNullOrEmpty(eqp.PhotoPath))
                                            {
                                                <img src="/images/equipments/@eqp.PhotoPath" alt="Avatar" class="rounded-circle">
                                            }
                                            else
                                            {
                                                <img src="../assets/img/avatars/5.png" alt="Avatar" class="rounded-circle">

                                            }
                                        </li>
                                    </ul>
                                </td>
                                <td>@eqp.Name</td>
                                @{
                                    var description = $"{eqp.Description.Substring(0, 1).ToUpper()}{eqp.Description.Substring(1, eqp.Description.Length > 50 ? 50 : eqp.Description.Length)}...";
                                }
                                <td>@description</td>
                                <td>@eqp.CreatedDate</td>
                                <td>@eqp.LastUpdatedDate</td>


                                <td>
                                    <div class="dropdown">
                                        <button type="button" class="btn p-0 dropdown-toggle hide-arrow" data-bs-toggle="dropdown" aria-expanded="false">
                                            <i class="bx bx-dots-vertical-rounded"></i>
                                        </button>
                                        <div class="dropdown-menu" style="">
                                            <a class="dropdown-item" asp-action="EquipmentDetails" asp-controller="Equipment" asp-route-id="@eqp.ID"><i class="bx bx-edit-alt me-1"></i> View</a>
                                            <a class="dropdown-item" asp-action="EditEquipmentDetails" asp-controller="Equipment" asp-route-id="@eqp.ID"><i class="bx bx-edit"></i> Edit</a>


                                            <button id="@eqp.ID" onclick="DeleteConfirmation(this.id)" class="dropdown-item"><i class="bx bx-trash me-1"></i> Delete</button>
                                            <a style="visibility: hidden; width: 0px; height: 0px" id="swalDelete-@eqp.ID" asp-controller="Equipment" asp-action="DeleteEquipment" asp-route-id="@eqp.ID" class="dropdown-item"><i class="bx bx-trash me-1"></i> Delete</a>

                                        </div>
                                    </div>
                                </td>
                            </tr>
                            i++;
                        }

                    </tbody>
                </table>
                <div style="text-align:left;margin:14px">
                    Showing @ViewBag.Partials of @ViewBag.TotalData
                </div>
                <div class="text-center">

                    <div class="demo-inline-spacing">
                        <!-- Basic Pagination -->
                        <nav aria-label="Page navigation">
                            <ul class="pagination" style="display:flex;justify-content:center">
                                <li class="page-item first">
                                    <a class="page-link" asp-controller="Equipment" asp-action="availableEquipments" asp-route-Pagenumber="1"><i class="tf-icon bx bx-chevrons-left"></i></a>
                                </li>
                                <li class="page-item prev">
                                    <a class="page-link" asp-controller="Equipment" asp-action="availableEquipments" asp-route-Pagenumber="@(ViewBag.PageNumber == 1 ? 1: ViewBag.PageNumber - 1)"><i class="tf-icon bx bx-chevron-left"></i></a>
                                </li>
                                @for (int j = 0; j < (int)ViewBag.Pages; j++)
                                {
                                    var isActive = (j + 1) == ViewBag.PageNumber ? "active" : "";
                                    <li class="page-item  @isActive">
                                        <a class="page-link" asp-controller="Equipment" asp-action="availableEquipments" asp-route-Pagenumber="@(j+1)"> @(j + 1) </a>
                                    </li>
                                }


                                <li class="page-item next">
                                    <a class="page-link" asp-controller="Equipment" asp-action="availableEquipments" asp-route-Pagenumber="@(ViewBag.PageNumber == ViewBag.Pages ? ViewBag.Pages: ViewBag.PageNumber + 1)"><i class="tf-icon bx bx-chevron-right"></i></a>
                                </li>
                                <li class="page-item last">
                                    <a class="page-link" asp-controller="Equipment" asp-action="availableEquipments" asp-route-Pagenumber="@ViewBag.Pages"><i class="tf-icon bx bx-chevrons-right"></i></a>
                                </li>
                            </ul>
                        </nav>
                        <!--/ Basic Pagination -->
                    </div>
                </div>

            }
            else
            {
                <div class="card-header">
                    No Equipments available yet
                </div>
            }
        </div>
    </div>
</div>
@section scripts{
        @await Html.PartialAsync("../Shared/Partials/changeEntries.cshtml")

    <script>
        function DeleteConfirmation(id) {
           
            Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, delete it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    document.querySelector("#swalDelete-" + id).click();
                }
            })
        }

    </script>
}